version: '3.8'
services:
  doc2md:
    build: . # Coolify vai construir a imagem a partir do seu Dockerfile
    networks:
      - network_public
    environment:
      # - OPENAI_API_KEY=sua_chave_aqui # REMOVA ESTA LINHA E CONFIGURE NO COOLIFY COMO SECRETO
      - LLM_MODEL=gpt-4o-mini
      - WORKERS=4
      - TIMEOUT=120

    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          cpus: "0.5"
          memory: 760M
      # REMOVA TODAS AS LABELS DE TRAEFIK OU CADDY AQUI:
      # labels:
      #   - traefik.enable=true
      #   - traefik.http.routers.doc2md.rule=Host(`api.doc2md.website.com`)
      #   - traefik.http.routers.doc2md.entrypoints=websecure
      #   - traefik.http.routers.doc2md.tls.certresolver=letsencryptresolver
      #   - traefik.http.routers.doc2md.priority=1
      #   - traefik.http.routers.doc2md.service=doc2md
      #   - traefik.http.services.doc2md.loadbalancer.server.port=7001
      #   - traefik.http.services.doc2md.loadbalancer.passHostHeader=true
      #   - caddy_0.handle_path.0_reverse_proxy={{upstreams 7001}}
      #   - caddy_0.handle_path=/conversor-arquivos.nicwalsolutions.com.br*
      #   - caddy_0.header=-Server
      #   - caddy_0.try_files={path} /index.html /index.php
      #   - caddy_0=https://
      #   - caddy_ingress_network=coolify

networks:
  network_public:
    name: network_public
    external: true
